<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Parametric regression tutorial &mdash; PyQt-Fit 1.3.1 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.3.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://c328740.ssl.cf1.rackcdn.com/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="PyQt-Fit 1.3.1 documentation" href="index.html" />
    <link rel="next" title="Non-Parametric regression tutorial" href="NonParam_tut.html" />
    <link rel="prev" title="Regression using the GUI - tutorial" href="GUI_tut.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="NonParam_tut.html" title="Non-Parametric regression tutorial"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="GUI_tut.html" title="Regression using the GUI - tutorial"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">PyQt-Fit 1.3.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="math">
\[\DeclareMathOperator{\erf}{erf}
\DeclareMathOperator{\argmin}{argmin}
\newcommand{\R}{\mathbb{R}}
\newcommand{\n}{\boldsymbol{n}}\]</div>
<div class="section" id="parametric-regression-tutorial">
<h1>Parametric regression tutorial<a class="headerlink" href="#parametric-regression-tutorial" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Given a set of observations <span class="math">\((x_i, y_i)\)</span>, with <span class="math">\(x_i = (x_{i1},
\ldots, x_{ip})^T \in \mathbb{R}^p\)</span>. We assume, there exists a function
<span class="math">\(f(\theta, x)\)</span> and a set of parameters <span class="math">\(\theta \in \mathbb{R}^q\)</span>
such that:</p>
<div class="math">
\[y_i = f(\theta, x_i) + \epsilon_i\]</div>
<p>with <span class="math">\(\epsilon_i \in \mathbb{R}\)</span> such that <span class="math">\(E(\epsilon) = 0\)</span>.</p>
<p>The objective is to fine the set of parameters <cite>theta</cite>. Obviously, the real
function is inaccesible. Instead, we will try to find an estimate of the
parameters, <span class="math">\(\hat{\theta}\)</span> using the least square estimator, which is:</p>
<div class="math">
\[\hat{\theta} = \argmin_{\theta \in \mathbb{R}^q} \left( f(\theta,x_i) - y_i \right)^2\]</div>
<p>The method is based on the SciPy function <tt class="docutils literal"><span class="pre">scipy.optimize.leastsq</span></tt>, which
relies on the MINPACK&#8217;s functions <tt class="docutils literal"><span class="pre">lmdif</span></tt> and <tt class="docutils literal"><span class="pre">lmder</span></tt>. Both functions
implement a modified Levenberg-Marquardt algorithm to solve the least-square
problem. Most of the output of the main curve fitting option will be the output
of the least-square function in scipy.</p>
</div>
<div class="section" id="a-simple-example">
<h2>A simple example<a class="headerlink" href="#a-simple-example" title="Permalink to this headline">¶</a></h2>
<p>As a simple example, we will take the function <span class="math">\(f\)</span> to be:</p>
<div class="math">
\[f((a_0,a_1,a_2),x) = a_0 + a_1 x + a_2 x^2\]</div>
<p>Let&#8217;s assume the points look like this:</p>
<div class="figure align-center">
<img alt="_images/Parm_tut_data.png" src="_images/Parm_tut_data.png" />
<p class="caption">Raw data for curve fitting</p>
</div>
<p>The data points have been generated by that script:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pylab</span> <span class="k">as</span> <span class="n">plt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mf">0.01</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="s">&#39;+&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;data&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;X&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Y&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>So we will expect to find something close to <span class="math">\((0,2,4)\)</span>.</p>
<p>To perform the analysis, we first need to define the function to be fitted:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="gp">... </span>  <span class="n">a0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span> <span class="o">=</span> <span class="n">params</span>
<span class="gp">... </span>  <span class="k">return</span> <span class="n">a0</span> <span class="o">+</span> <span class="n">a1</span><span class="o">*</span><span class="n">x</span><span class="o">+</span> <span class="n">a2</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span>
</pre></div>
</div>
<p>Then, we construct a <tt class="xref py py-class docutils literal"><span class="pre">CurveFitting</span></tt> object, which computes and stores the
optimal parameters, and also behaves as a function for the fitted data:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pyqt_fit</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fit</span> <span class="o">=</span> <span class="n">pyqt_fit</span><span class="o">.</span><span class="n">CurveFitting</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="n">f</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="s">&quot;The parameters are: a0 = {0}, a1 = {1}, a2 = {2}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">fit</span><span class="o">.</span><span class="n">popt</span><span class="p">)</span>
<span class="go">The parameters are: a0 = 0.142870141922, a1 = 1.33420587099, a2 = 4.27241667343</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">yfitted</span> <span class="o">=</span> <span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">fit</span></tt> object, beside being a callable object to evaluate the fitting
function as some points, contain the following properties:</p>
<blockquote>
<div><dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">fct</span></tt></dt>
<dd>Function being fitted (e.g. the one given as argument)</dd>
<dt><tt class="docutils literal"><span class="pre">popt</span></tt></dt>
<dd>Optimal parameters for the function</dd>
<dt><tt class="docutils literal"><span class="pre">res</span></tt></dt>
<dd>Residuals of the fitted data</dd>
<dt><tt class="docutils literal"><span class="pre">pcov</span></tt></dt>
<dd>Covariance of the parameters around the optimal values.</dd>
<dt><tt class="docutils literal"><span class="pre">infodict</span></tt></dt>
<dd>Additional estimation outputs, as given by <tt class="xref py py-func docutils literal"><span class="pre">scipy.optimize.leastsq()</span></tt></dd>
</dl>
</div></blockquote>
<div class="section" id="fitting-analysis">
<h3>Fitting analysis<a class="headerlink" href="#fitting-analysis" title="Permalink to this headline">¶</a></h3>
<p>PyQt-Fit also has tools to evaluate your fitting. You can use them as a whole:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyqt_fit</span> <span class="kn">import</span> <span class="n">plot_fit</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">plot_fit</span><span class="o">.</span><span class="n">fit_evaluation</span><span class="p">(</span><span class="n">fit</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span>
<span class="gp">... </span>                                <span class="n">fct_desc</span> <span class="o">=</span> <span class="s">&quot;$y = a_0 + a_1 x + a_2 x^2$&quot;</span><span class="p">,</span>
<span class="gp">... </span>                                <span class="n">param_names</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;a_0&#39;</span><span class="p">,</span> <span class="s">&#39;a_1&#39;</span><span class="p">,</span> <span class="s">&#39;a_2&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>You can then examine the <tt class="docutils literal"><span class="pre">result</span></tt> variable. But you can also perform only the
analysis you need. For example, you can compute the data needed for the
residual analysis with:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">rm</span> <span class="o">=</span> <span class="n">plot_fit</span><span class="o">.</span><span class="n">residual_measures</span><span class="p">(</span><span class="n">fit</span><span class="o">.</span><span class="n">res</span><span class="p">)</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">rm</span></tt> is a named tuple with the following fields:</p>
<blockquote>
<div><dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">scaled_res</span></tt></dt>
<dd>Scaled residuals, sorted in ascending values for residuals. The scaled
residuals are computed as <span class="math">\(sr_i = \frac{r_i}{\sigma_r}\)</span>, where
<span class="math">\(\sigma_r\)</span> is the variance of the residuals.</dd>
<dt><tt class="docutils literal"><span class="pre">res_IX</span></tt></dt>
<dd>Ordering indices for the residuals in scaled_res. This orders the residuals
in an ascending manner.</dd>
<dt><tt class="docutils literal"><span class="pre">prob</span></tt></dt>
<dd>List of quantiles used to compute the normalized quantiles.</dd>
<dt><tt class="docutils literal"><span class="pre">normq</span></tt></dt>
<dd>Value expected for the quantiles in <tt class="docutils literal"><span class="pre">prob</span></tt> if the distribution is normal.
The foluma is: <span class="math">\(\Phi(p) = \sqrt{2}
\erf^{-1}(2p-1), p\in[0;1]\)</span></dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="plotting-the-results">
<h3>Plotting the results<a class="headerlink" href="#plotting-the-results" title="Permalink to this headline">¶</a></h3>
<p>At last, you can use the display used for the GUI:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">handles</span> <span class="o">=</span> <span class="n">plot_fit</span><span class="o">.</span><span class="n">plot1d</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
<p>What you will obtain are these two graphs:</p>
<div class="figure align-center">
<img alt="_images/Parm_tut_est_function.png" src="_images/Parm_tut_est_function.png" />
<p class="caption">Curve fitting output</p>
</div>
<div class="figure align-center">
<img alt="_images/Parm_tut_residuals.png" src="_images/Parm_tut_residuals.png" />
<p class="caption">Residual checking output</p>
</div>
<p>Do not hesitate to look at the code for <a class="reference internal" href="mod_plot_fit.html#pyqt_fit.plot_fit.plot1d" title="pyqt_fit.plot_fit.plot1d"><tt class="xref py py-func docutils literal"><span class="pre">pyqt_fit.plot_fit.plot1d()</span></tt></a> to examine
how things are plotted. The function should return all the handles you may need
to tune the presentation of the various curves.</p>
</div>
<div class="section" id="speeding-up-the-fitting-providing-the-jacobian">
<h3>Speeding up the fitting: providing the jacobian<a class="headerlink" href="#speeding-up-the-fitting-providing-the-jacobian" title="Permalink to this headline">¶</a></h3>
<p>The least-square algorithm uses the jacobian (i.e. the derivative of the function with respect to each parameter on each
point). By default, the jacobian is estimated numerically, which can be quite expensive (if the function itself is). But
in many cases, it is fairly easy to compute. For example, in our case we have:</p>
<div class="math">
\[\begin{split}\begin{array}{rcl}
\frac{\partial f(x)}{\partial a_0} &amp;=&amp; 1 \\
\frac{\partial f(x)}{\partial a_1} &amp;=&amp; x \\
\frac{\partial f(x)}{\partial a_2} &amp;=&amp; x^2
\end{array}\end{split}\]</div>
<p>By default, the derivatives should be given in columns (i.e. each line correspond to a parameter, each column to
a point):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">df</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="gp">... </span>  <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="gp">... </span>  <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
<span class="gp">... </span>  <span class="n">result</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span>
<span class="gp">... </span>  <span class="k">return</span> <span class="n">result</span> <span class="c"># result[0] is already 1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fit</span><span class="o">.</span><span class="n">Dfun</span> <span class="o">=</span> <span class="n">df</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fit</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
<p>Of course there is no change in the result, but it should be slightly faster (note that in this case, the function is so
fast that to make it worth it, you need a lot of points as input).</p>
</div>
</div>
<div class="section" id="confidence-intervals">
<h2>Confidence Intervals<a class="headerlink" href="#confidence-intervals" title="Permalink to this headline">¶</a></h2>
<p>PyQt-Fit provides bootstrapping methods to compute confidence intervals.
Bootstrapping is a method to estimate confidence interval and probability
distribution by resampling the data provided. For our problem, we will call:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pyqt_fit.bootstrap</span> <span class="kn">as</span> <span class="nn">bs</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">bootstrap</span><span class="p">(</span><span class="n">pyqt_fit</span><span class="o">.</span><span class="n">CurveFitting</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">eval_points</span> <span class="o">=</span> <span class="n">xs</span><span class="p">,</span> <span class="n">fit_kwrds</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">p0</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">function</span> <span class="o">=</span> <span class="n">f</span><span class="p">),</span> <span class="n">CI</span> <span class="o">=</span> <span class="p">(</span><span class="mi">95</span><span class="p">,</span><span class="mi">99</span><span class="p">),</span> <span class="n">extra_attrs</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;popt&#39;</span><span class="p">,))</span>
</pre></div>
</div>
<p>This will compute the 95% and 99% confidence intervals for the curves and for
the optimised parameters (<tt class="docutils literal"><span class="pre">popt</span></tt>). The result is a named tuple
<a class="reference internal" href="mod_bootstrap.html#pyqt_fit.bootstrap.BootstrapResult" title="pyqt_fit.bootstrap.BootstrapResult"><tt class="xref py py-class docutils literal"><span class="pre">pyqt_fit.bootstrap.BootstrapResult</span></tt></a>. The most important field are
<tt class="docutils literal"><span class="pre">y_est</span></tt> and <tt class="docutils literal"><span class="pre">CIs</span></tt> that provide the estimated values and the confidence
intervals for the curve and for the parameters.</p>
<p>On the data, the result can be plotted with:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">y_fit</span><span class="p">(</span><span class="n">xs</span><span class="p">),</span> <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&quot;Fitted curve&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">CIs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="s">&#39;g--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;95% CI&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">CIs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="s">&#39;g--&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">CIs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">result</span><span class="o">.</span><span class="n">CIs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;g&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>The result is:</p>
<div class="figure align-center">
<img alt="_images/Parm_tut_CI.png" src="_images/Parm_tut_CI.png" />
<p class="caption">Drawing of the 95% confidence interval</p>
</div>
<p>The bounds for the parameters are obtained with:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="s">&quot;95% CI for p0 = {}-{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">result</span><span class="o">.</span><span class="n">CIs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="s">&quot;99% CI for p0 = {}-{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">result</span><span class="o">.</span><span class="n">CIs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
<span class="go">95% CI for p0 = [-0.84216998 -0.20389559  3.77950689]-[ 1.14753806  2.8848943   4.7557855 ]</span>
<span class="go">99% CI for p0 = [-1.09413524 -0.62373955  3.64217184]-[ 1.40142123  3.32762714  4.91391328]</span>
</pre></div>
</div>
<p>It is also possible to obtain the full distribution of the values for the curve
and for the parameters by providing the argument <tt class="docutils literal"><span class="pre">full_results=True</span></tt> and by
looking at <tt class="docutils literal"><span class="pre">result.full_results</span></tt>.</p>
</div>
<div class="section" id="defining-the-functions-and-residuals">
<h2>Defining the functions and residuals<a class="headerlink" href="#defining-the-functions-and-residuals" title="Permalink to this headline">¶</a></h2>
<div class="section" id="user-defined-function">
<h3>User-defined function<a class="headerlink" href="#user-defined-function" title="Permalink to this headline">¶</a></h3>
<p>The function must be a two argument python function:</p>
<blockquote>
<div><ol class="arabic simple">
<li>the parameters of the function, provided either as a tuple or a ndarray</li>
<li>the values on which the function is to be evaluated, provided as a single value or a ndarray</li>
</ol>
</div></blockquote>
<p>If the second argument is a ndarray of shape <tt class="docutils literal"><span class="pre">(...,N)</span></tt>, the output must be a ndarray of shape <tt class="docutils literal"><span class="pre">(N,)</span></tt>.</p>
<p>If is also possible to provide the function computing the Jacobian of the
estimation function. The arguments are the same as for the function, but the
shape of the output must be <tt class="docutils literal"><span class="pre">(P,N)</span></tt>, where <tt class="docutils literal"><span class="pre">P</span></tt> is the number of parameters
to be fitted, unless the option <tt class="docutils literal"><span class="pre">col_deriv</span></tt> is set to 0, in which case the
shape of the output must be <tt class="docutils literal"><span class="pre">(N,P)</span></tt>.</p>
</div>
<div class="section" id="user-defined-residuals">
<h3>User-defined residuals<a class="headerlink" href="#user-defined-residuals" title="Permalink to this headline">¶</a></h3>
<p>It is also possible to redefine the notion of residuals. A common example is to
use the log of the residuals. It is most applicable if the standard deviation
of the residuals is proportional to the fitted quantity. The residual should be
a function of two arguments:</p>
<blockquote>
<div><ol class="arabic simple">
<li>the measured data</li>
<li>the fitted data</li>
</ol>
</div></blockquote>
<p>For example, the log residuals would be:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">log_residuals</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y0</span><span class="p">):</span>
<span class="gp">... </span>  <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">y1</span><span class="o">/</span><span class="n">y0</span><span class="p">)</span>
</pre></div>
</div>
<p>As for the user-defined function, it is possible to provide the jacobian of the
residuals. It must be provided as a function of 3 arguments:</p>
<blockquote>
<div><ol class="arabic simple">
<li>the measured data</li>
<li>the fitted data</li>
<li>the jacobian of the function on the fitted data</li>
</ol>
</div></blockquote>
<p>The shape of the output must be the same as the shape of the jacobian of the
function. For example, if <tt class="docutils literal"><span class="pre">col_deriv</span></tt> is set to True, the jacobian of the
log-residuals will be defined as:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">Dlog_residual</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">y0</span><span class="p">):</span>
<span class="gp">... </span>  <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">y0</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:]</span>
</pre></div>
</div>
<p>This is because:</p>
<div class="math">
\[\mathcal{J}\left(\log\frac{y_1}{y_0}\right) = -\frac{\mathcal{J}(y_0)}{y_0}\]</div>
<p>as <span class="math">\(y_1\)</span> is a constant, and <span class="math">\(y_0\)</span> depend on the parameters.</p>
<p>Also, methods like the residuals bootstrapping will require a way to apply
residuals on fitted data. For this, you will need to provide a function such as:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">invert_log_residuals</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">res</span><span class="p">):</span>
<span class="gp">... </span>  <span class="k">return</span> <span class="n">y</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</pre></div>
</div>
<p>This function should be such that this expression returns always true:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">all</span><span class="p">(</span><span class="n">log_residuals</span><span class="p">(</span><span class="n">invert_log_residuals</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">res</span><span class="p">),</span> <span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="n">res</span><span class="p">)</span>
</pre></div>
</div>
<p>Of course, working with floating point values, this is usually not happening.
So a better test function would be:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">sum</span><span class="p">((</span><span class="n">log_residuals</span><span class="p">(</span><span class="n">invert_log_residuals</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">res</span><span class="p">),</span> <span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="n">res</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">epsilon</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="using-the-functions-residuals-defined-for-the-gui">
<h2>Using the functions/residuals defined for the GUI<a class="headerlink" href="#using-the-functions-residuals-defined-for-the-gui" title="Permalink to this headline">¶</a></h2>
<p>It is also possible to use the functions and residuals defined for the GUI. The
interface for this are via the modules <tt class="xref py py-mod docutils literal"><span class="pre">pyqt_fit.functions</span></tt> and
<tt class="xref py py-mod docutils literal"><span class="pre">pyqt_fit.residuals</span></tt>.</p>
<p>The list of available functions can be retrieved with:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">pyqt_fit</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">names</span><span class="p">()</span>
<span class="go">[&#39;Power law&#39;, &#39;Exponential&#39;, &#39;Linear&#39;, &#39;Logistic&#39;]</span>
</pre></div>
</div>
<p>And a function is retrieved with:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="n">pyqt_fit</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;Logistic&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The function is an object with the following properties:</p>
<blockquote>
<div><dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">__call__</span></tt></dt>
<dd>Evaluate the function on a set of points, as described in the previous section</dd>
<dt><tt class="docutils literal"><span class="pre">Dfun</span></tt></dt>
<dd>Evaluate the jacobian of the function. If not available, this property is set to <tt class="docutils literal"><span class="pre">None</span></tt></dd>
<dt><tt class="docutils literal"><span class="pre">args</span></tt></dt>
<dd>Name of the arguments</dd>
<dt><tt class="docutils literal"><span class="pre">description</span></tt></dt>
<dd>Formula or description of the evaluated function</dd>
<dt><tt class="docutils literal"><span class="pre">init_args</span></tt></dt>
<dd>Function provided a reasonnable first guess for the parameters. Should be called with <tt class="docutils literal"><span class="pre">f.init_args(x,y)</span></tt>.</dd>
</dl>
</div></blockquote>
<p>In the same way, the list of available residuals can be retrieved with:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">pyqt_fit</span><span class="o">.</span><span class="n">residuals</span><span class="o">.</span><span class="n">names</span><span class="p">()</span>
<span class="go">[&#39;Difference of the logs&#39;, &#39;Standard&#39;]</span>
</pre></div>
</div>
<p>And a residuals function is retrieved with:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">pyqt_fit</span><span class="o">.</span><span class="n">residuals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;Difference of the logs&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The residuals is an object with the following properties:</p>
<blockquote>
<div><dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">__call__</span></tt></dt>
<dd>Evaluate the residuals, as described in the previous section</dd>
<dt><tt class="docutils literal"><span class="pre">Dfun</span></tt></dt>
<dd>Evaluate the jacobian of the residuals. If not available, this property is set to <tt class="docutils literal"><span class="pre">None</span></tt></dd>
<dt><tt class="docutils literal"><span class="pre">invert</span></tt></dt>
<dd>Function that apply the residuals to a set of fitted data. It will be
called as <tt class="docutils literal"><span class="pre">r.invert(y,</span> <span class="pre">res)</span></tt>. It should have the properties of the invert
function described in the previous section.</dd>
<dt><tt class="docutils literal"><span class="pre">description</span></tt></dt>
<dd>Description of the kind of residuals</dd>
<dt><tt class="docutils literal"><span class="pre">name</span></tt></dt>
<dd>Name of the residuals.</dd>
</dl>
</div></blockquote>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Parametric regression tutorial</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#a-simple-example">A simple example</a><ul>
<li><a class="reference internal" href="#fitting-analysis">Fitting analysis</a></li>
<li><a class="reference internal" href="#plotting-the-results">Plotting the results</a></li>
<li><a class="reference internal" href="#speeding-up-the-fitting-providing-the-jacobian">Speeding up the fitting: providing the jacobian</a></li>
</ul>
</li>
<li><a class="reference internal" href="#confidence-intervals">Confidence Intervals</a></li>
<li><a class="reference internal" href="#defining-the-functions-and-residuals">Defining the functions and residuals</a><ul>
<li><a class="reference internal" href="#user-defined-function">User-defined function</a></li>
<li><a class="reference internal" href="#user-defined-residuals">User-defined residuals</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-the-functions-residuals-defined-for-the-gui">Using the functions/residuals defined for the GUI</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="GUI_tut.html"
                        title="previous chapter">Regression using the GUI - tutorial</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="NonParam_tut.html"
                        title="next chapter">Non-Parametric regression tutorial</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/Param_tut.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="NonParam_tut.html" title="Non-Parametric regression tutorial"
             >next</a> |</li>
        <li class="right" >
          <a href="GUI_tut.html" title="Regression using the GUI - tutorial"
             >previous</a> |</li>
        <li><a href="index.html">PyQt-Fit 1.3.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Barbier de Reuille, Pierre.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>